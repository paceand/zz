<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIANO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            padding: 20px;
        }

        h1 {
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .piano-container {
            position: relative;
            display: flex;
            gap: 2px;
            background: #111;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* 白键样式 */
        .white-key {
            width: 70px;
            height: 280px;
            background: linear-gradient(to bottom, #fff 95%, #eee);
            border: 2px solid #333;
            border-radius: 0 0 8px 8px;
            cursor: pointer;
            position: relative;
            z-index: 1;
            transition: all 0.1s ease;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 20px;
            font-weight: bold;
            color: #333;
        }

        .white-key.active {
            background: linear-gradient(to bottom, #eee 95%, #ddd);
            transform: translateY(2px);
        }

        /* 黑键样式 */
        .black-key {
            width: 45px;
            height: 180px;
            background: linear-gradient(to bottom, #111 95%, #333);
            border: 2px solid #333;
            border-radius: 0 0 6px 6px;
            cursor: pointer;
            position: absolute;
            z-index: 2;
            transition: all 0.1s ease;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 15px;
            color: #fff;
        }

        .black-key.active {
            background: linear-gradient(to bottom, #222 95%, #444);
            transform: translateY(2px);
        }

        /* 黑键位置定位 */
        .black-key:nth-child(2) { left: 52px; }
        .black-key:nth-child(4) { left: 122px; }
        .black-key:nth-child(7) { left: 262px; }
        .black-key:nth-child(9) { left: 332px; }
        .black-key:nth-child(11) { left: 402px; }

        .instructions {
            margin-top: 40px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            max-width: 600px;
            text-align: center;
        }

        .instructions h2 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .instructions p {
            margin: 8px 0;
            line-height: 1.6;
        }

        /* 响应式适配 */
        @media (max-width: 768px) {
            .white-key {
                width: 50px;
                height: 200px;
            }
            
            .black-key {
                width: 35px;
                height: 130px;
            }
            
            .black-key:nth-child(2) { left: 37px; }
            .black-key:nth-child(4) { left: 87px; }
            .black-key:nth-child(7) { left: 187px; }
            .black-key:nth-child(9) { left: 237px; }
            .black-key:nth-child(11) { left: 287px; }
        }
    </style>
</head>
<body>
    <h1>PIANO</h1>
    
    <div class="piano-container" id="piano">
        <!-- 白键 -->
        <div class="white-key" data-note="C4" data-key="a">A</div>
        <!-- 黑键 -->
        <div class="black-key" data-note="C#4" data-key="w">W</div>
        <div class="white-key" data-note="D4" data-key="s">S</div>
        <!-- 黑键 -->
        <div class="black-key" data-note="D#4" data-key="e">E</div>
        <div class="white-key" data-note="E4" data-key="d">D</div>
        <div class="white-key" data-note="F4" data-key="f">F</div>
        <!-- 黑键 -->
        <div class="black-key" data-note="F#4" data-key="t">T</div>
        <div class="white-key" data-note="G4" data-key="g">G</div>
        <!-- 黑键 -->
        <div class="black-key" data-note="G#4" data-key="y">Y</div>
        <div class="white-key" data-note="A4" data-key="h">H</div>
        <!-- 黑键 -->
        <div class="black-key" data-note="A#4" data-key="u">U</div>
        <div class="white-key" data-note="B4" data-key="j">J</div>
        <div class="white-key" data-note="C5" data-key="k">K</div>
    </div>

    <div class="instructions">
        <h2>操作说明 | Instructions</h2>
        <p>鼠标点击琴键或按下对应键盘按键弹奏 | Click keys or press keyboard to play</p>
        <p>白键对应：A S D F G H J K | White keys: A S D F G H J K</p>
        <p>黑键对应：W E T Y U | Black keys: W E T Y U</p>
        <p>按下发声，松开停止 | Press to play, release to stop</p>
    </div>

    <script>
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioContext = new AudioContext();

        const noteFrequencies = {
            'C4': 261.63,
            'C#4': 277.18,
            'D4': 293.66,
            'D#4': 311.13,
            'E4': 329.63,
            'F4': 349.23,
            'F#4': 369.99,
            'G4': 392.00,
            'G#4': 415.30,
            'A4': 440.00,
            'A#4': 466.16,
            'B4': 493.88,
            'C5': 523.25
        };

        const activeOscillators = {};
        const pressedKeys = {};

        function playNote(note) {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }

            if (activeOscillators[note]) {
                return () => {
                    if (activeOscillators[note]) {
                        activeOscillators[note].gainNode.gain.linearRampToValueAtTime(
                            0, audioContext.currentTime + 0.1
                        );
                        setTimeout(() => {
                            try {
                                activeOscillators[note].oscillator.stop();
                                delete activeOscillators[note];
                            } catch (e) {}
                        }, 100);
                    }
                };
            }

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.value = noteFrequencies[note] || 440;
            
            gainNode.gain.value = 0;
            gainNode.gain.linearRampToValueAtTime(0.7, audioContext.currentTime + 0.01);
            gainNode.gain.linearRampToValueAtTime(0.6, audioContext.currentTime + 0.1);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.start();

            activeOscillators[note] = { oscillator, gainNode };

            return () => {
                if (activeOscillators[note]) {
                    activeOscillators[note].gainNode.gain.linearRampToValueAtTime(
                        0, audioContext.currentTime + 0.1
                    );
                    setTimeout(() => {
                        try {
                            activeOscillators[note].oscillator.stop();
                            delete activeOscillators[note];
                        } catch (e) {}
                    }, 100);
                }
            };
        }

        const keys = document.querySelectorAll('.white-key, .black-key');

        keys.forEach(key => {
            let stopNote;
            
            key.addEventListener('mousedown', () => {
                key.classList.add('active');
                const note = key.dataset.note;
                stopNote = playNote(note);
            });

            const releaseKey = () => {
                key.classList.remove('active');
                if (stopNote) stopNote();
            };

            key.addEventListener('mouseup', releaseKey);
            key.addEventListener('mouseleave', releaseKey);
        });

        document.addEventListener('keydown', (e) => {
            if (e.repeat || pressedKeys[e.key.toLowerCase()]) return;
            
            const keyElement = document.querySelector(`[data-key="${e.key.toLowerCase()}"]`);
            if (keyElement) {
                pressedKeys[e.key.toLowerCase()] = true;
                keyElement.classList.add('active');
                const note = keyElement.dataset.note;
                const stopNote = playNote(note);
                keyElement._stopNote = stopNote;
            }
        });

        document.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            const keyElement = document.querySelector(`[data-key="${key}"]`);
            
            if (keyElement) {
                keyElement.classList.remove('active');
                if (keyElement._stopNote) {
                    keyElement._stopNote();
                    delete keyElement._stopNote;
                }
                delete pressedKeys[key];
            }
        });

        window.addEventListener('blur', () => {
            Object.keys(pressedKeys).forEach(key => {
                const keyElement = document.querySelector(`[data-key="${key}"]`);
                if (keyElement) {
                    keyElement.classList.remove('active');
                    if (keyElement._stopNote) {
                        keyElement._stopNote();
                        delete keyElement._stopNote;
                    }
                }
                delete pressedKeys[key];
            });
        });

        document.addEventListener('click', () => {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }, { once: true });
    </script>
</body>
</html>